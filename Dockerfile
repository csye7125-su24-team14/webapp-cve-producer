FROM golang:1.22.4 AS BuildStage
 
WORKDIR /webapp-cve-producer
 
COPY go.mod go.sum ./
 
RUN go mod download
 
COPY main.go  ./
 
COPY producer ./producer
 
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o /build main.go

 
FROM alpine:latest AS build-release-stage
 
WORKDIR /
 
COPY --from=BuildStage /build /build

ENTRYPOINT [ "./build" ]